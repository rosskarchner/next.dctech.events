<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - DC Tech Events</title>
    <meta name="description" content="Manage your DC Tech Events profile settings">
    <link rel="stylesheet" href="/static/css/main.css">
    <script src="https://unpkg.com/htmx.org@2.0.4"></script>
    <style>
        .settings-container {
            max-width: 600px;
            margin: 0 auto;
        }

        .settings-section {
            background: white;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-lg);
        }

        .settings-section h2 {
            margin-top: 0;
            font-size: 1.25rem;
            padding-bottom: var(--spacing-sm);
            border-bottom: 1px solid var(--color-border);
            margin-bottom: var(--spacing-lg);
        }

        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: var(--spacing-sm);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-family: inherit;
            box-sizing: border-box;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-group small {
            display: block;
            margin-top: var(--spacing-xs);
            color: var(--color-text-light);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
        }

        .checkbox-group label {
            margin-bottom: 0;
            font-weight: normal;
        }

        .btn {
            padding: var(--spacing-sm) var(--spacing-lg);
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
        }

        .btn-primary {
            background-color: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--color-primary-hover);
        }

        #result {
            margin-bottom: var(--spacing-md);
        }

        .success {
            background-color: #f0fdf4;
            border: 1px solid #86efac;
            color: #166534;
            padding: var(--spacing-sm);
            border-radius: var(--border-radius);
        }

        .error {
            background-color: #fef2f2;
            border: 1px solid #fca5a5;
            color: #991b1b;
            padding: var(--spacing-sm);
            border-radius: var(--border-radius);
        }

        .link-input-row {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-sm);
        }

        .link-input-row input:first-child {
            flex: 1;
        }

        .link-input-row input:last-child {
            flex: 2;
        }
    </style>
</head>

<body>
    {{> header}}

    <main class="container">
        <div class="settings-container">
            <h1>Settings</h1>

            <form hx-put="/api/users/me" hx-target="#result" hx-swap="innerHTML" hx-ext="json-enc">
                <div id="result"></div>

                <div class="settings-section">
                    <h2>Profile</h2>

                    <div class="form-group">
                        <label for="nickname">Nickname</label>
                        <input type="text" id="nickname" name="nickname" value="{{user.nickname}}" minlength="3"
                            maxlength="30" pattern="[a-zA-Z0-9_-]+" autocomplete="off">
                        <small>Your public display name. 3-30 characters.</small>
                    </div>

                    <div class="form-group">
                        <label for="bio">Bio</label>
                        <textarea id="bio" name="bio" rows="3" maxlength="500"
                            placeholder="Tell us a bit about yourself...">{{user.bio}}</textarea>
                        <small>Up to 500 characters.</small>
                    </div>

                    <div class="form-group">
                        <label for="avatarUrl">Avatar URL</label>
                        <input type="url" id="avatarUrl" name="avatarUrl" value="{{user.avatarUrl}}"
                            placeholder="https://example.com/avatar.jpg">
                        <small>Link to your profile picture.</small>
                    </div>
                </div>

                <div class="settings-section">
                    <h2>Privacy</h2>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="showRsvps" name="showRsvps" value="true" {{#if
                                user.showRsvps}}checked{{/if}}>
                            <label for="showRsvps">Show my name on RSVP lists</label>
                        </div>
                        <small>When unchecked, your RSVPs will be counted but your name won't be displayed.</small>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">Save Changes</button>
            </form>
        </div>
    </main>

    {{> footer}}

    <script>
        // Show success message on save
        document.body.addEventListener('htmx:afterRequest', function (evt) {
            if (evt.detail.successful && evt.detail.xhr.status === 200) {
                document.getElementById('result').innerHTML = '<div class="success">Settings saved successfully!</div>';
                setTimeout(function () {
                    document.getElementById('result').innerHTML = '';
                }, 3000);
            }
        });
    </script>
</body>

</html>